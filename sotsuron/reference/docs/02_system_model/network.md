# ネットワーク構成

## セル配置

| 記号             | 説明                 | 値  |
| :--------------- | :------------------- | :-- |
| $N_{macro}$      | マクロ gNB 数        | 1   |
| $N_{micro}$      | マイクロ gNB 数      | 1   |
| $N_{UE}^{macro}$ | マクロセルの UE 数   | 10  |
| $N_{UE}^{micro}$ | マイクロセルの UE 数 | 10  |
| $N_{UE}^{total}$ | 総 UE 数             | 20  |

### 座標系

| 記号                     | 説明             | 値                     |
| :----------------------- | :--------------- | :--------------------- |
| $(x_{macro}, y_{macro})$ | マクロセル位置   | $(0, 0)$（原点）       |
| $(x_{micro}, y_{micro})$ | マイクロセル位置 | $(d, 0)$               |
| $d$                      | 基地局間距離     | シミュレーションで変化 |

> [!NOTE]
> マクロセルがマイクロセルを完全に包含する構成。
> マイクロセル（ローカル 5G）が優先、マクロセルが非優先として周波数共用を行う。

---

## セル半径と送信電力

### セル半径の定義

セル端での受信電力が $P_{rx,edge} = -84.6$ dBm となる距離をセル半径とする。

$$P_{rx,edge} = P_{tx} + G_{tx} + G_{rx} - PL(R_{cell}) - L_{margin}$$

$$P_{tx} = P_{rx,edge} - G_{tx} - G_{rx} + PL(R_{cell}) + L_{margin}$$

### パラメータ

| 記号          | 説明           | マクロセル | マイクロセル |
| :------------ | :------------- | :--------- | :----------- |
| $R_{cell}$    | セル半径       | 300 m      | 50 m         |
| $P_{rx,edge}$ | セル端受信電力 | -84.6 dBm  | -84.6 dBm    |
| $P_{tx}$      | 送信電力       | 逆算       | 逆算         |

> [!IMPORTANT]
> 設定ファイルでは送信電力の代わりにセル半径を指定する。
> 送信電力はパスロスモデルを用いてセル半径から自動計算される。

---

## UE 配置

- **マクロ UE**: マクロセル半径 $R_{macro}$ 内にランダム配置
- **マイクロ UE**: マイクロセル半径 $R_{micro}$ 内にランダム配置
- 配置は各シナリオで乱数シードにより決定

### 配置ロジック（極座標）

$$r = R_{cell} \cdot \sqrt{U}, \quad \theta = 2\pi V$$

| 記号     | 説明                |
| :------- | :------------------ |
| $U, V$   | $[0, 1)$ の一様乱数 |
| $r$      | 中心からの距離      |
| $\theta$ | 角度                |

> [!NOTE] > $\sqrt{U}$ を使用することで、半径内で均一な面積密度を実現する。

---

## TDD（時分割複信）

5G NR TDD モードでは、同一周波数帯でダウンリンク(DL)とアップリンク(UL)を時間的に分割して通信。

### スロット方向パターン

| パターン | 説明                | DL 比率 |
| :------- | :------------------ | :------ |
| `DU`     | DL/UL 交互          | 50%     |
| `DDDU`   | DL:UL = 3:1         | 75%     |
| `DDDSU`  | DL:DL:DL:Special:UL | 60%     |

> [!IMPORTANT]
> 本シミュレータでは交互パターン（`DU`）をデフォルトとし、
> DL スロットでは DL トラフィックのみ、UL スロットでは UL のみを処理。

### スロット方向判定

$$direction(t) = \begin{cases} DL & \text{if } t \mod 2 = 0 \\ UL & \text{if } t \mod 2 = 1 \end{cases}$$

---

## 関連ドキュメント

- [チャネルモデル](./channel.md) - パスロス計算、セル半径
- [シミュレーション設定](./simulation.md) - 距離範囲、反復回数
