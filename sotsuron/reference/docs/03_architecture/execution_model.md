# 二段階実行モデル

シミュレータは**テストデータ生成**と**シミュレーション実行**の 2 段階で動作する。

---

## 実行フロー

```
┌─────────────────────────────────────────────────────────────────────┐
│                        Phase 1: データ生成                          │
│  local5g-sim generate → トラフィック、チャネル、環境データを生成    │
└─────────────────────────────────────────────────────────────────────┘
                                ↓
                        データセットファイル
                                ↓
┌─────────────────────────────────────────────────────────────────────┐
│                     Phase 2: シミュレーション                        │
│  local5g-sim simulate → データを読み込み、周波数共用をシミュレート  │
└─────────────────────────────────────────────────────────────────────┘
```

---

## Phase 1: テストデータ生成

| 項目     | 内容                                          |
| :------- | :-------------------------------------------- |
| コマンド | `local5g-sim generate`                        |
| 入力     | 設定ファイル（config.toml）                   |
| 出力     | データセットディレクトリ                      |
| 処理     | UE 配置、トラフィック、チャネル状態を事前生成 |

### 生成されるデータ

- `traffic.parquet` - パケット到着ログ
- `channel.parquet` - UE ごとのチャネル状態
- `environment.parquet` - UE 配置情報
- `metadata.json` - シナリオメタデータ

---

## Phase 2: シミュレーション実行

| 項目     | 内容                                         |
| :------- | :------------------------------------------- |
| コマンド | `local5g-sim simulate`                       |
| 入力     | データセットディレクトリ                     |
| 出力     | 結果 CSV                                     |
| 処理     | 周波数共用アルゴリズムを適用し評価指標を計算 |

---

## 二段階モデルの利点

1. **再現性**: 同一データセットで複数手法を比較可能
2. **効率**: データ生成は 1 回のみ、シミュレーションは複数回実行可能
3. **デバッグ**: データ生成とシミュレーションを独立してテスト可能

---

## 関連ドキュメント

- [CLI インターフェース](./cli.md) - コマンド詳細
- [データスキーマ](../05_data_schema.md) - ファイル形式
