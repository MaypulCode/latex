% !TEX root = ../main.tex
\chapter{提案手法}\label{chap:proposed_method}
本章では，提案するHARQ連携型予測帯域切替手法の詳細を説明する．
まず提案手法の概要を述べ，次に傾向予測アルゴリズム，急激変化検知アルゴリズム，および切替判断アルゴリズムについて数式を交えて詳述する．
最後に，HARQとの連携機構と計算量の評価について述べる．

\section{周波数利用効率 (Spectral Efficiency)}

本システムは，マクロセル（Macrocell: M）とマイクロセル（Microcell: m）からなるHetNet環境を対象とする．

マイクロセルを優先してリソースブロック（RB）$N_{\mathrm{RB}}^{\mathrm{m}}$ を割り当て，残余リソース $N_{\mathrm{RB}}^{\mathrm{M}}$ をマクロセルが使用する周波数分割方式を採用する．

ここで，システム全体の周波数利用効率 $\eta_{\mathrm{SE}}^{\mathrm{sys}}$ の最大化を目的とする．

\subsection{共通定義と観測パラメータ}

システム帯域幅を $W$，総RB数を $N_{\mathrm{RB}}^{\mathrm{total}}$ とする．

各セル $k \in \{\mathrm{m}, \mathrm{M}\}$ における帯域幅 $B^k$ は次式で表される．

\begin{equation}
    B^k = W \cdot \frac{N_{\mathrm{RB}}^k}{N_{\mathrm{RB}}^{\mathrm{total}}}
\end{equation}

直前の期間 $T$ において，基地局側で取得可能な観測値セットを $\mathcal{O}^k$ とする．

\begin{itemize}
    \item $R_{\mathrm{obs}}^k$: 送出量より算出された観測スループット (DL UE Throughput)
    \item $\lambda^k$: 到来量 (Ingress data at PDCP)
    \item $\bar{D}^k$: 観測された平均遅延 (MAC/RLC measurement)
    \item $P_{\mathrm{out}}^k$: パケットドロップ率 (RLC SDU drop rate)
    \item $\gamma_{\mathrm{obs}}^k$: UEからのCQI報告に基づき推定された観測SINR
    \item $P_{\mathrm{t, ref}}^k$: 観測時の送信電力
    \item $N_{\mathrm{RB, obs}}^k$: 観測時の割り当てRB数
\end{itemize}

\subsection{マイクロセル (Microcell) の定式化}

マイクロセルは優先的にリソースが割り当てられるが，自身の送信電力 $P_{\mathrm{t}}^{\mathrm{m}}$ を調整することで，エネルギー効率の改善とマクロセルへの干渉抑制を図る．

まず，物理層容量を予測する．マイクロセルのSINR $\hat{\gamma}^{\mathrm{m}}$ は，自身の送信電力密度に比例してスケーリングされると仮定する．

マクロセルからの干渉は定常的なフロアノイズとして扱う近似を用いると，次ステップの送信電力 $P_{\mathrm{t}}^{\mathrm{m}}$ および割り当てRB数 $N_{\mathrm{RB}}^{\mathrm{m}}$ に対する予測SINRは次式となる．

\begin{equation}
    \hat{\gamma}^{\mathrm{m}} = \gamma_{\mathrm{obs}}^{\mathrm{m}} \cdot \frac{P_{\mathrm{t}}^{\mathrm{m}}}{P_{\mathrm{t, ref}}^{\mathrm{m}}} \cdot \frac{N_{\mathrm{RB, obs}}^{\mathrm{m}}}{N_{\mathrm{RB}}^{\mathrm{m}}}
    \label{eq:memo_micro_sinr_pred}
\end{equation}

これより，ドロップ率 $P_{\mathrm{out}}^{\mathrm{m}}$ を考慮した物理容量 $C^{\mathrm{m}}$ は次式で予測される．

\begin{equation}
    C^{\mathrm{m}} = B^{\mathrm{m}} \cdot \log_2 \left( 1 + \hat{\gamma}^{\mathrm{m}} \right) \cdot \left(1 - P_{\mathrm{out}}^{\mathrm{m}}\right)
\end{equation}

トラフィック需要 $R_{\mathrm{req}}^{\mathrm{m}}$ は，観測された到来量 $\lambda^{\mathrm{m}}$ と遅延 $\bar{D}^{\mathrm{m}}$ を用いてリトルの法則より算出する．

\begin{equation}
    R_{\mathrm{req}}^{\mathrm{m}} = \lambda^{\mathrm{m}} + \frac{\lambda^{\mathrm{m}} \bar{D}^{\mathrm{m}}}{T}
\end{equation}

したがって，マイクロセルの予測スループット $\hat{R}^{\mathrm{m}}$ は需要と容量のボトルネックにより決定される．

\begin{equation}
    \hat{R}^{\mathrm{m}} = \min \left( C^{\mathrm{m}}, R_{\mathrm{req}}^{\mathrm{m}} \right)
\end{equation}

\subsection{マクロセル (Macrocell) の定式化}

マクロセルは，マイクロセルが使用しなかった残余RBを使用する（$N_{\mathrm{RB}}^{\mathrm{M}} = N_{\mathrm{RB}}^{\mathrm{total}} - N_{\mathrm{RB}}^{\mathrm{m}}$）．
本検討において，マクロセルの総送信電力は一定であり，マイクロセルからの干渉変動の影響は無視できるものと仮定する．

したがって，マクロセルの予測SINR $\hat{\gamma}^{\mathrm{M}}$ は，マイクロセルの場合と同様に電力密度の変化（割り当てRB数によるスケーリング）のみを考慮し，次式で表される．

\begin{equation}
    \hat{\gamma}^{\mathrm{M}} = \gamma_{\mathrm{obs}}^{\mathrm{M}} \cdot \frac{N_{\mathrm{RB, obs}}^{\mathrm{M}}}{N_{\mathrm{RB}}^{\mathrm{M}}}
    \label{eq:macro_sinr_prediction}
\end{equation}

これより，マクロセルの予測スループット $\hat{R}^{\mathrm{M}}$ は以下の通りとなる．

\begin{equation}
    \hat{R}^{\mathrm{M}} = \min \left( B^{\mathrm{M}} \log_2(1 + \hat{\gamma}^{\mathrm{M}})(1 - P_{\mathrm{out}}^{\mathrm{M}}), R_{\mathrm{req}}^{\mathrm{M}} \right)
\end{equation}

\subsection{システム全体の周波数利用効率}
システム全体の予測周波数利用効率 $\hat{\eta}_{\mathrm{SE}}^{\mathrm{sys}}$ [bps/Hz] は，両セルのスループットの和をシステム帯域幅で除算したものとして定義される．

\begin{equation}
    \hat{\eta}_{\mathrm{SE}}^{\mathrm{sys}} = \frac{\hat{R}^{\mathrm{m}} + \hat{R}^{\mathrm{M}}}{W}
\end{equation}

\section{エネルギー効率 (Energy Efficiency)}

本研究では，マイクロセルの送信電力調整によるエネルギー効率の最大化に着目する．
システム全体のエネルギー効率も定義可能ですが，最適化の主目的となるマイクロセルのエネルギー効率を優先的に定式化する．

\subsection{マイクロセルのエネルギー効率}

マイクロセルのエネルギー効率 $\eta_{\mathrm{EE}}^{\mathrm{m}}$ [bits/J] は，消費電力に対する有効スループットの比として定義される．

\begin{equation}
    \eta_{\mathrm{EE}}^{\mathrm{m}} = \frac{\hat{R}^{\mathrm{m}}}{P_{\mathrm{c}}^{\mathrm{m}}}
\end{equation}

ここで，マイクロセルの総消費電力 $P_{\mathrm{c}}^{\mathrm{m}}$ [W] は，固定回路電力 $P_{\mathrm{fix}}^{\mathrm{m}}$ と，送信電力 $P_{\mathrm{t}}^{\mathrm{m}}$ に依存する変動電力の和でモデル化される．

本システムにおけるローカル5G基地局（Sub6帯）の電力増幅器（PA）の実効効率 $\eta_{\mathrm{PA}}$ を約 40\% と想定する．
これにより，消費電力係数 $\xi$ は $\xi = 1/\eta_{\mathrm{PA}} = 2.5$ と設定される．
したがって，総消費電力は次式で表される．

\begin{equation}
    P_{\mathrm{c}}^{\mathrm{m}} = P_{\mathrm{fix}}^{\mathrm{m}} + 2.5 P_{\mathrm{t}}^{\mathrm{m}}
\end{equation}

以上より，決定変数 $P_{\mathrm{t}}^{\mathrm{m}}, N_{\mathrm{RB}}^{\mathrm{m}}$ に対する予測エネルギー効率は次式で定式化される．

\begin{equation}
    \hat{\eta}_{\mathrm{EE}}^{\mathrm{m}} = \frac{\min \left( C^{\mathrm{m}}, R_{\mathrm{req}}^{\mathrm{m}} \right)}{P_{\mathrm{fix}}^{\mathrm{m}} + 2.5 P_{\mathrm{t}}^{\mathrm{m}}}
\end{equation}

\section{最適化問題の定式化}

本研究の目的は，システム全体の周波数利用効率 $\hat{\eta}_{\mathrm{SE}}^{\mathrm{sys}}$ およびマイクロセルのエネルギー効率 $\hat{\eta}_{\mathrm{EE}}^{\mathrm{m}}$ を最大化する，マイクロセルの送信電力 $P_{\mathrm{t}}^{\mathrm{m}}$ およびRB割り当て数 $N_{\mathrm{RB}}^{\mathrm{m}}$ を決定することです．

これら2つの指標は単位および数値のオーダーが大きく異なるため，単純な線形加重和ではスケールの大きいEEが支配的となる．
本稿では，この問題に対処するため，Cobb-Douglas効用関数（Cobb-Douglas utility function）を用いた多目的最適化問題として定式化する．

Cobb-Douglas効用関数は，異なるスケールを持つ複数の指標を統合する際に有効であり，スケール不変性と乗法的構造という2つの重要な特性を持つ．
スケール不変性により，単位やオーダーが異なるSEとEEを公平に扱うことが可能となる．
また，乗法的構造により，一方の指標のみを極端に優先するのではなく，両指標をバランスよく改善するインセンティブが与えられる．

さらに，本稿ではCobb-Douglas効用関数を対数変換した形式で定式化する．
対数変換により，最適解を保存したまま数値計算の安定性が向上し，かつ目的関数が凹関数となるため最適化が容易になるという利点がある．

\subsection{決定変数の定義}

\subsubsection{RB数の離散集合}
マイクロセルに割り当て可能なRB数 $N_{\mathrm{RB}}^{\mathrm{m}}$ は，システム全体のRB数 $N_{\mathrm{RB}}^{\mathrm{total}}$ に基づいて制限される．
選択可能なRB数の集合 $\mathcal{N}$ を以下のように定義する．

\begin{equation}
    \mathcal{N} = \left\{ n \mid n \in \mathbb{Z}, 1 \le n \le N_{\mathrm{RB}}^{\mathrm{total}} \right\}
\end{equation}

\subsubsection{送信電力の離散集合}
マイクロセルの送信電力 $P_{\mathrm{t}}^{\mathrm{m}}$ は，1dB刻みで調整可能な離散変数とする．
現在の設定送信電力を $P_{\mathrm{t, current}}^{\mathrm{m}}$，マイクロセルのカバレッジがマクロセルのカバレッジと内接する（境界が接する）際の送信電力を $P_{\mathrm{t, inscribed}}^{\mathrm{m}}$ とする．
これに基づき，選択可能な送信電力の集合 $\mathcal{P}$ を以下のように定義する．

\begin{equation}
    \mathcal{P} = \left\{ P \mid P_{\mathrm{dB}} \in \{ P_{\mathrm{min, dB}}, P_{\mathrm{min, dB}} + 1, \dots, P_{\mathrm{max, dB}} \}, P = 10^{\frac{P_{\mathrm{dB}} - 30}{10}} \right\}
\end{equation}

ここで，$P_{\mathrm{min, dB}}$ および $P_{\mathrm{max, dB}}$ はそれぞれ $P_{\mathrm{t, current}}^{\mathrm{m}}$ および $P_{\mathrm{t, inscribed}}^{\mathrm{m}}$ をdBm単位で表した値とする．

\subsubsection{トラフィック負荷}
リソース配分の公平性とマイクロセルへの優先度を評価するため，各セル $k$ におけるトラフィック負荷 $\rho^k$ を，予測容量に対する要求量の比として定義する．

\begin{equation}
    \rho^k = \frac{R_{\mathrm{req}}^k}{\hat{R}_{\mathrm{cap}}^k}
\end{equation}

ここで，$\hat{R}_{\mathrm{cap}}^k$ はパケットドロップ等を考慮しない物理層の最大予測容量（$C^k$ に相当）です．

\subsection{目的関数}
重み係数 $w$ ($0 \le w \le 1$) を用いて，目的関数 $U$ を次式で定義する．

\begin{equation}
    U(P_{\mathrm{t}}^{\mathrm{m}}, N_{\mathrm{RB}}^{\mathrm{m}}) = w \ln \left( \hat{\eta}_{\mathrm{SE}}^{\mathrm{sys}} \right) + (1 - w) \ln \left( \hat{\eta}_{\mathrm{EE}}^{\mathrm{m}} \right)
\end{equation}

\subsection{制約条件}
最適化における制約条件は以下の通りです．

\begin{align}
    \text{maximize} \quad   & U(P_{\mathrm{t}}^{\mathrm{m}}, N_{\mathrm{RB}}^{\mathrm{m}})                 \\
    \text{subject to} \quad & N_{\mathrm{RB}}^{\mathrm{m}} \in \mathcal{N}, \label{eq:const_rb_discrete}   \\
                            & P_{\mathrm{t}}^{\mathrm{m}} \in \mathcal{P}, \label{eq:const_power_discrete} \\
                            & \rho^{\mathrm{m}} \le \rho^{\mathrm{M}} \label{eq:const_load_balance}
\end{align}

式（\ref{eq:const_rb_discrete}）はマイクロセルに割り当て可能なRB数の範囲を定義し，式（\ref{eq:const_power_discrete}）は送信電力が1dBステップの離散値をとることを示します．
式（\ref{eq:const_load_balance}）はマイクロセルのトラフィック負荷がマクロセル以下となることを強制する制約です．
この負荷制約により，マイクロセルに十分なリソース（RBおよび電力）を優先的に割り当て，局所的な輻輳の回避を保証します．

この問題は，離散変数（RB数セット $\mathcal{N}$ および電力セット $\mathcal{P}$）の組み合わせ最適化問題となります．